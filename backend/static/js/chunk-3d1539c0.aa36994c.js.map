{"version":3,"sources":["webpack:///./src/views/message/Message.vue","webpack:///./src/views/message/Message.vue?17c0","webpack:///./src/components/search/Search.vue","webpack:///./src/components/search/Search.vue?8ae3","webpack:///./src/views/message/Message.vue?02e4","webpack:///./src/components/items/Avatar.vue?dee4","webpack:///./src/components/items/Avatar.vue","webpack:///./src/components/items/Avatar.vue?8b51","webpack:///./src/assets/default/empty-image.png","webpack:///./src/components/search/Search.vue?a8f0"],"names":["class","activeList","length","description","image","item","index","key","title","getName","label","getString","toChat","icon","size","avatarLink","getAvatar","value","getUnReadCount","content","max","initWebSocket","name","computed","state","message","rmap","relation","map","mmap","methods","this","setAccess","$router","push","getRelation","remark","initRelation","getLatestMessage","string","main","substring","mounted","components","Search","Avatar","render","type","shape","show-action","placeholder","searchOption","optionValue","text","focus","blur","left","show","showPopover","theme","actions","onSelect","placement","reference","action","onSearch","closeSearch","result","users","nickName","account","toExhibt","groups","ownId","showResult","searchFocus","QUERY_TYPE","KEY_WORD","ACCOUNT","GROUP","LOCAL","setup","console","log","openSearch","query","then","res","JSON","stringify","id","round","width","height","src","props","String","default","__scopeId","module","exports"],"mappings":"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","file":"js/chunk-3d1539c0.aa36994c.js","sourcesContent":["<template>\r\n  <div class=\"message\">\r\n    <search></search>\r\n    <van-empty\r\n      v-if=\"activeList.length == 0\"\r\n      description=\"没有消息\"\r\n      :image=\"require('assets/default/empty-image.png')\"\r\n    />\r\n    <van-cell\r\n      v-for=\"(item, index) in activeList\"\r\n      :key=\"index\"\r\n      :title=\"getName(item)\"\r\n      :label=\"getString(item)\"\r\n      @click=\"toChat(item)\"\r\n    >\r\n      <template #icon>\r\n        <avatar size=\"3rem\" :avatarLink=\"getAvatar(item)\" />\r\n      </template>\r\n      <template #value>\r\n        <van-badge\r\n          v-if=\"getUnReadCount(item) > 0\"\r\n          :content=\"getUnReadCount(item)\"\r\n          max=\"99\"\r\n        />\r\n      </template>\r\n    </van-cell>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Search from \"components/search/Search\";\r\nimport { mapState, mapGetters, mapMutations, mapActions } from \"vuex\";\r\n\r\nimport Avatar from \"../../components/items/Avatar.vue\";\r\n\r\nimport wsConnection from \"service/websocket/index\";\r\nwsConnection.initWebSocket();\r\n\r\nexport default {\r\n  name: \"message\",\r\n  computed: {\r\n    ...mapState({\r\n      activeList: (state) => state.message.activeList,\r\n      rmap: (state) => state.relation.map,\r\n      mmap: (state) => state.message.map,\r\n    }),\r\n    ...mapGetters([\r\n      \"getLatestMessage\",\r\n      \"getRelation\",\r\n      \"getUnReadCount\",\r\n      \"getProfile\",\r\n      \"getAvatar\",\r\n    ]),\r\n  },\r\n  methods: {\r\n    ...mapActions([\"initProfile\", \"initRelation\"]),\r\n    ...mapMutations([\"setAccess\"]),\r\n    toChat(item) {\r\n      this.setAccess(item);\r\n      this.$router.push(\"/chat\");\r\n    },\r\n    getName(item) {\r\n      let name = this.rmap ? this.getRelation(item) : \"\";\r\n      if (name) {\r\n        return name.remark;\r\n      } else {\r\n        this.initRelation();\r\n      }\r\n    },\r\n    getString(item) {\r\n      const message = this.getLatestMessage(item);\r\n      if (message) {\r\n        const string = message.main.content;\r\n        if (string.length > 10) {\r\n          return string.substring(0, 10) + \"......\";\r\n        }\r\n        return string;\r\n      } else {\r\n        return \"\";\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    this.rmap.size > 0 ? null : this.initRelation();\r\n    // this.mmap.size > 0 ? null : console.log(\"0\");\r\n  },\r\n  components: {\r\n    Search,\r\n    Avatar,\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.message {\r\n  padding-bottom: 50px;\r\n}\r\n</style>","import { render } from \"./Message.vue?vue&type=template&id=b96272ba\"\nimport script from \"./Message.vue?vue&type=script&lang=js\"\nexport * from \"./Message.vue?vue&type=script&lang=js\"\n\nimport \"./Message.vue?vue&type=style&index=0&id=b96272ba&lang=css\"\nscript.render = render\n\nexport default script","<template>\r\n  <div class=\"search\">\r\n    <van-search\r\n      v-model=\"value\"\r\n      shape=\"round\"\r\n      show-action\r\n      :placeholder=\"searchOption[optionValue].text + '搜索'\"\r\n      @focus=\"focus()\"\r\n      @blur=\"blur()\"\r\n    >\r\n      <template #left>\r\n        <van-popover\r\n          v-model:show=\"showPopover\"\r\n          theme=\"dark\"\r\n          :actions=\"searchOption\"\r\n          @select=\"onSelect\"\r\n          placement=\"bottom-start\"\r\n        >\r\n          <template #reference>\r\n            <button type=\"primary\" class=\"search-button\">选项</button>\r\n          </template>\r\n        </van-popover>\r\n      </template>\r\n      <template #action>\r\n        <button @click=\"onSearch\" class=\"search-button\">搜索</button>\r\n      </template>\r\n    </van-search>\r\n    <div class=\"search-result\" v-show=\"searchFocus\" @click=\"closeSearch()\">\r\n      <div class=\"results\" v-show=\"showResult\">\r\n        <van-cell-group\r\n          title=\"用户\"\r\n          v-if=\"result.users && result.users.length > 0\"\r\n        >\r\n          <van-cell\r\n            :title=\"item.nickName\"\r\n            :value=\"item.account\"\r\n            v-for=\"(item, index) in result.users\"\r\n            :key=\"index\"\r\n            @click.stop=\"toExhibt(item)\"\r\n          />\r\n        </van-cell-group>\r\n        <van-cell-group\r\n          title=\"群组\"\r\n          v-if=\"result.groups && result.groups.length > 0\"\r\n        >\r\n          <van-cell\r\n            :title=\"item.name\"\r\n            :value=\"item.ownId\"\r\n            v-for=\"(item, index) in result.groups\"\r\n            :key=\"index\"\r\n            @click.stop=\"toExhibt(item)\"\r\n          />\r\n        </van-cell-group>\r\n      </div>\r\n      <div class=\"close-tips\">(点击空白处退出搜索)</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref } from \"vue\";\r\nimport { mapMutations } from \"vuex\";\r\n\r\nimport { Toast } from \"vant\";\r\nimport { GROUP_TYPE, USER_TYPE } from \"../../common/config\";\r\n\r\nimport { queryByKeyWord } from \"../../service/http/query\";\r\n\r\nconst QUERY_TYPE = {\r\n  KEY_WORD: 0,\r\n  ACCOUNT: 1,\r\n  GROUP: 2,\r\n  LOCAL: 3,\r\n};\r\n\r\nexport default {\r\n  setup() {\r\n    const showPopover = ref(false);\r\n    const value = ref(\"\");\r\n    const result = ref(\"\");\r\n    const searchFocus = ref(false);\r\n    const showResult = ref(false);\r\n    const optionValue = ref(QUERY_TYPE.KEY_WORD);\r\n    const searchOption = [\r\n      { text: \"关键字\", value: QUERY_TYPE.KEY_WORD },\r\n      { text: \"账户\", value: QUERY_TYPE.ACCOUNT },\r\n      { text: \"群组\", value: QUERY_TYPE.GROUP },\r\n      { text: \"本地\", value: QUERY_TYPE.LOCAL },\r\n    ];\r\n\r\n    return {\r\n      showPopover,\r\n      value,\r\n      result,\r\n      searchFocus,\r\n      optionValue,\r\n      searchOption,\r\n      showResult,\r\n    };\r\n  },\r\n  methods: {\r\n    ...mapMutations([\"setAccess\"]),\r\n    onSelect(action, index) {\r\n      this.optionValue = this.searchOption[index].value;\r\n    },\r\n    onSearch() {\r\n      console.log(\"search\");\r\n      this.openSearch();\r\n      switch (this.optionValue) {\r\n        case QUERY_TYPE.KEY_WORD:\r\n          queryByKeyWord(this.value).then((res) => {\r\n            this.result = res;\r\n            this.showResult = true;\r\n          });\r\n          break;\r\n        case QUERY_TYPE.ACCOUNT:\r\n          Toast(\"功能待完成\");\r\n          break;\r\n        case QUERY_TYPE.GROUP:\r\n          Toast(\"功能待完成\");\r\n          break;\r\n        case QUERY_TYPE.LOCAL:\r\n          Toast(\"功能待完成\");\r\n          break;\r\n      }\r\n    },\r\n    focus() {\r\n      this.openSearch();\r\n    },\r\n    blur() {\r\n      this.closeSearch();\r\n    },\r\n    openSearch() {\r\n      console.log(\"open\");\r\n      this.searchFocus = true;\r\n    },\r\n    closeSearch() {\r\n      console.log(\"close\");\r\n      this.searchFocus = false;\r\n    },\r\n    toExhibt(item) {\r\n      const key = JSON.stringify({\r\n        id: item.id,\r\n        type: item.ownId ? GROUP_TYPE : USER_TYPE,\r\n      });\r\n      this.setAccess(key);\r\n      this.$router.push(\"/exhibt\");\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style >\r\n.search-button {\r\n  border-radius: 50px;\r\n  height: 34px ;\r\n  padding: 0 2vw;\r\n}\r\n\r\n.search-button {\r\n  color: rgb(50, 50, 51);\r\n  box-shadow: rgba(100, 101, 102, 0.12) 0px 2px 12px 0px;\r\n  border: none;\r\n  padding: 0 4vw;\r\n  background: #fff;\r\n  overflow: hidden;\r\n  font-size: 14px;\r\n}\r\n.search-button:active,\r\n.search-button:focus {\r\n  background: #fff;\r\n  color: rgb(25, 137, 250);\r\n}\r\n\r\n.search-result {\r\n  position: fixed;\r\n  top: 68px;\r\n  height: 100vh;\r\n  width: 100vw;\r\n  background: #fff;\r\n  z-index: 2;\r\n}\r\n\r\n.search .search-result .close-tips {\r\n  display: flex;\r\n  justify-content: center;\r\n  padding: 5vh 0;\r\n  color: #999;\r\n}\r\n</style>","import { render } from \"./Search.vue?vue&type=template&id=3b8500fb\"\nimport script from \"./Search.vue?vue&type=script&lang=js\"\nexport * from \"./Search.vue?vue&type=script&lang=js\"\n\nimport \"./Search.vue?vue&type=style&index=0&id=3b8500fb&lang=css\"\nscript.render = render\n\nexport default script","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Message.vue?vue&type=style&index=0&id=b96272ba&lang=css\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Avatar.vue?vue&type=style&index=0&id=77e4a452&scoped=true&lang=css\"","<template>\r\n  <van-image round :width=\"size\" :height=\"size\" :src=\"avatarLink\" />\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: {\r\n    avatarLink: {\r\n      type: String,\r\n      default: require(\"assets/default/avatar.jpg\"),\r\n    },\r\n    size: {\r\n      type: String,\r\n      default: \"80\",\r\n    },\r\n  },\r\n  mounted() {\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.avatar {\r\n  position: relative;\r\n  margin: 0;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n</style>","import { render } from \"./Avatar.vue?vue&type=template&id=77e4a452&scoped=true\"\nimport script from \"./Avatar.vue?vue&type=script&lang=js\"\nexport * from \"./Avatar.vue?vue&type=script&lang=js\"\n\nimport \"./Avatar.vue?vue&type=style&index=0&id=77e4a452&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-77e4a452\"\n\nexport default script","module.exports = __webpack_public_path__ + \"img/empty-image.0bc9958e.png\";","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Search.vue?vue&type=style&index=0&id=3b8500fb&lang=css\""],"sourceRoot":""}